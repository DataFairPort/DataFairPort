Content-type: text/html

<html>
<head><title>FAIRport Metadata Capture Demo</title></head>
<body><div style='margin-left:20px; background-color:#feefe2'>
<h1>Extended Authorship Information</h1> <span style='font-size:.5em;'>(* = required field)</span><br/><br/>


<b>Creator (free):</b> 
<input type='text' name='DCCreator]' value='string'/><br/>


* <b>Author ORCID:</b> 
<div style='margin-left:80px; background-color:#d6fbce'>
<h1>ORCID Records</h1> <span style='font-size:.5em;'>(* = required field)</span><br/><br/>


<b>ORCID ID:</b> 
<input type='text' name='http://datafairport.org/examples/ProfileSchemas/Examples/ORCID_Class#orcid_id]' value='string'/><br/>


<b>ORCID URL:</b> 
<input type='text' name='http://datafairport.org/examples/ProfileSchemas/Examples/ORCID_Class#orcid_url]' value='anyURI'/><br/>
</div></div><div style='margin-left:20px; background-color:#f5e5cc'>
<h1>Core Microarray Data Distribution Metadata</h1> <span style='font-size:.5em;'>(* = required field)</span><br/><br/>

* <b>mediaType (controlled vocabulary) :</b> 

<select name='http://purl.org/dc/terms/mediaType'>
<option value='http://edamontology.org/format_2056'>Microarray experiment data format</option>
<option value='http://edamontology.org/format_3161'>MAGE-ML</option>
<option value='http://edamontology.org/format_1641'>affymetrix-exp</option>
<option value='http://edamontology.org/format_3162'>MAGE-TAB</option>
</select>

<br/><br/>


<b>Description:</b> 
<input type='text' name='http://purl.org/dc/terms/description]' value='string'/><br/>


<b>Title:</b> 
<input type='text' name='http://purl.org/dc/terms/title]' value='string'/><br/>
</div><div style='margin-left:20px; background-color:#faddc9'>
<h1>Microarray Generation Protocol Metadata</h1> <span style='font-size:.5em;'>(* = required field)</span><br/><br/>

* <b>generated by prootocol type (limited by EFO ontology) :</b> 

<select name='http://datafairport.org/examples/ProfileSchemas/MicroarrayMetadata.rdf#protocol_type'>
<option value='http://www.ebi.ac.uk/efo/EFO_0003816'>normalization data transformation protocol</option>
<option value='http://www.ebi.ac.uk/efo/EFO_0003788'>gene expression protocol</option>
<option value='http://www.ebi.ac.uk/efo/EFO_0003813'>nucleic acid labeling protocol</option>
<option value='http://www.ebi.ac.uk/efo/EFO_0002944'>nucleic acid extraction protocol</option>
<option value='http://www.ebi.ac.uk/efo/EFO_0004917'>high throughput sequence alignment protocol</option>
<option value='http://www.ebi.ac.uk/efo/EFO_0003815'>nucleic acid hybridization to array protocol</option>
<option value='http://www.ebi.ac.uk/efo/EFO_0003814'>array scanning and feature extraction protocol</option>
</select>

<br/><br/>


<b>generated by protocol (free text):</b> 
<input type='text' name='http://datafairport.org/examples/ProfileSchemas/MicroarrayMetadata.rdf#generated_by_protocol]' value='string'/><br/>
</div><br/><br/><br/>The code that generated this page is:<br/><br/>
<pre>
#!/usr/bin/perl
use strict;
use lib &quot;../&quot;;
use warnings;
use DCAT::Profile::Parser;
use LWP::Simple;
use RDF::Query;
use Ontology::Views::SKOS::NAMESPACES;
use Ontology::Views::SKOS::conceptSchemeBuilder;
use strict;
use warnings;
use Template;

# some useful options (see below for full list)
my $config = {
    INCLUDE_PATH =&gt; ['./Templates/', './'],  # or list ref
    POST_CHOMP   =&gt; 1,               # cleanup whitespace 
    RELATIVE  =&gt; 1,
};


my $template = Template-&gt;new($config) || die $Template::ERROR, &quot;\n&quot;;


print &quot;Content-type: text/html\n\n&quot;;

$template-&gt;process(&quot;header&quot;, {title =&gt; &quot;FAIRport Metadata Capture Demo&quot;}) || die $template-&gt;error();


my $parser = DCAT::Profile::Parser-&gt;new(filename =&gt; &quot;http://biordf.org/DataFairPort/ProfileSchemas/DemoMicroarrayProfileScheme.rdf&quot;); 
my $Profile = $parser-&gt;parse;

my $classes = $Profile-&gt;has_class;
my $margin = 20;
foreach my $class(@$classes){
    &amp;parseClass($class, $margin);    
}

$template-&gt;process(&quot;footer&quot;) || die $template-&gt;error();


sub parseClass {
    my ($class, $margin) = @_;
    my $background = join &quot;&quot; =&gt; &quot;#&quot;, map { sprintf &quot;%02x&quot;, (rand 55)+200 } 1 .. 3;
    my $title = $class-&gt;label;

    $template-&gt;process(&quot;newsection.tt&quot;, {title =&gt; $title, margin =&gt; $margin, background =&gt; $background}) || die $template-&gt;error();
    
    my @embeddedclasses; # stack-up external classes for display aesthetics

    foreach my $property(@{$class-&gt;has_property}){
        my $values = $property-&gt;allowed_values;
        foreach my $valueURL(@$values){
	    
            if (isScalar($valueURL)) {
		$template-&gt;process(&quot;scalar.tt&quot;, {property =&gt; $property, xsd_type =&gt; isScalar($valueURL)}) || die $template-&gt;error();

            } elsif (isConceptScheme($valueURL)) {
		my $b = Ontology::Views::SKOS::conceptSchemeBuilder-&gt;new();
		my $scheme = $b-&gt;parseFile($valueURL);
		$template-&gt;process(&quot;dropdown.tt&quot;, {property =&gt; $property, concepts =&gt; $scheme-&gt;Concepts}) || die $template-&gt;error();
		
	    } elsif (isDCATModel($valueURL)) {
		push @embeddedclasses, [$property, $valueURL];  # stack them up and deal with them later for layout purposes
		
	    } else {
                print &quot;&lt;i&gt;$valueURL&lt;/i&gt; is neither a SKOS Concept Scheme nor a DCAT Profile&lt;br/&gt;\n&quot;;
            }
        }
    }
    # now we have to deal with the referenced classes
    foreach my $pair(@embeddedclasses){
        my ($property, $classurl) = @{$pair};
        my $parser = DCAT::Profile::Parser-&gt;new(filename =&gt; $classurl);
        my $Profile = $parser-&gt;parse;
        
        my $classes = $Profile-&gt;has_class;
	$template-&gt;process(&quot;externalclass.tt&quot;, {property =&gt; $property}) || die $template-&gt;error();
        $margin = $margin + 60;  # indent
        foreach my $class(@$classes){
            &amp;parseClass($class, $margin);    
        }                    
    }
    $template-&gt;process(&quot;divend&quot;,) || die $template-&gt;error();

}

sub isScalar {
    my ($value) =  @_;
    if ($value =~ m'http://www.w3.org/2001/XMLSchema#(.\S+)'){
        return $1;	
    } else {
	return 0
    }
}

sub isDCATModel {
    my ($URL) = @_;
    my $store = RDF::Trine::Store::Memory-&gt;new();
    my $model = RDF::Trine::Model-&gt;new($store);
    RDF::Trine::Parser-&gt;parse_url_into_model($URL, $model );
    my $query = RDF::Query-&gt;new( &quot;SELECT ?o WHERE {&lt;$URL&gt; a ?o}&quot; );  # what is at the other end of that URL?
    my $iterator = $query-&gt;execute( $model );
    my $profile;
    while (my $row = $iterator-&gt;next) {
	my $type = $row-&gt;{ 'o' }-&gt;value;
	next if ($type =~ m'/owl#Ontology');
	my $dctsschematype = DCTS.&quot;DPSProfile&quot;;
	if ($type =~ m&quot;$dctsschematype&quot;) {
	    return $URL;
	}
    }
}

sub isConceptScheme {
    my ($URL) = @_;
    my $store = RDF::Trine::Store::Memory-&gt;new();
    my $model = RDF::Trine::Model-&gt;new($store);
    RDF::Trine::Parser-&gt;parse_url_into_model($URL, $model );
    my $query = RDF::Query-&gt;new( &quot;SELECT ?o WHERE {&lt;$URL&gt; a ?o}&quot; );  # what is at the other end of that URL?
    my $iterator = $query-&gt;execute( $model );
    my $profile;
    while (my $row = $iterator-&gt;next) {
	my $type = $row-&gt;{ 'o' }-&gt;value;
	next if ($type =~ m'/owl#Ontology');
	return $URL if ($type =~ m'http://www.w3.org/2004/02/skos/core#ConceptScheme');
    }
}</pre>
</body>
</html>